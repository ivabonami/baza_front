<template>
  <transition name="list">
  <div class="tabs" v-if="this.products.length > 0">
    <div class="tabs-links">
      <button
         v-on:click=" () => {
           this.products = this.products.slice(this.products.length, this.products.length)
           getProducts('random')
           this.tab = 'recommended'
         }"
         class="recommended"
        :class="{
           active: this.tab === 'recommended'
        }">
        <svg id="a" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64.93 64.94">
          <path class="b"
                d="M62.87,33.84c-.75-.76-.75-1.99,0-2.74l1.21-1.23c.67-.67,.96-1.6,.81-2.54-.15-.94-.72-1.72-1.56-2.16l-1.54-.8c-.94-.49-1.32-1.66-.85-2.61l.77-1.55c.42-.85,.42-1.82,0-2.66-.43-.84-1.21-1.42-2.15-1.57l-1.71-.28c-1.05-.17-1.77-1.17-1.61-2.22l.26-1.71c.14-.94-.16-1.86-.83-2.53-.67-.67-1.59-.98-2.53-.83l-1.71,.26c-1.04,.16-2.04-.56-2.22-1.61l-.28-1.71c-.15-.94-.73-1.72-1.57-2.15-.84-.43-1.81-.43-2.66,0l-1.55,.77c-.95,.47-2.12,.1-2.61-.85l-.79-1.54c-.44-.84-1.22-1.41-2.16-1.56-.93-.15-1.86,.15-2.54,.81l-1.23,1.21h0c-.76,.75-1.99,.75-2.74,0l-1.23-1.21c-.68-.67-1.6-.96-2.54-.81-.94,.15-1.72,.72-2.16,1.56l-.8,1.54c-.49,.94-1.65,1.33-2.61,.85l-1.55-.77c-.84-.42-1.82-.42-2.66,0-.84,.43-1.42,1.21-1.57,2.15l-.28,1.71c-.17,1.05-1.17,1.77-2.22,1.61l-1.71-.26c-.94-.14-1.86,.16-2.53,.83-.67,.67-.97,1.59-.83,2.53l.26,1.71c.16,1.05-.56,2.04-1.61,2.22l-1.71,.28c-.93,.15-1.72,.73-2.15,1.57-.43,.84-.43,1.81,0,2.66l.77,1.55c.48,.95,.1,2.12-.85,2.61l-1.53,.8c-.84,.44-1.41,1.22-1.56,2.16-.15,.94,.15,1.86,.81,2.54l1.21,1.23c.75,.76,.75,1.99,0,2.74l-1.21,1.23c-.67,.67-.96,1.6-.81,2.54,.15,.94,.72,1.72,1.56,2.16l1.54,.8c.94,.49,1.32,1.66,.85,2.61l-.77,1.55c-.42,.85-.42,1.82,0,2.66s1.21,1.42,2.15,1.57l1.71,.28c1.05,.17,1.77,1.17,1.61,2.22l-.26,1.71c-.14,.94,.16,1.86,.83,2.53,.67,.67,1.59,.98,2.53,.83l1.71-.26c1.05-.16,2.04,.57,2.22,1.61l.28,1.71c.15,.93,.73,1.72,1.57,2.15,.84,.43,1.82,.43,2.66,0l1.55-.77c.95-.48,2.12-.1,2.61,.85l.8,1.53c.44,.84,1.22,1.41,2.16,1.56,.16,.03,.32,.04,.47,.04,.77,0,1.5-.3,2.06-.85l1.23-1.21c.76-.75,1.99-.75,2.74,0l1.23,1.21c.68,.67,1.6,.97,2.54,.81,.94-.15,1.72-.72,2.16-1.56l.79-1.53c.49-.94,1.66-1.33,2.61-.85l1.55,.77c.85,.42,1.82,.42,2.66,0,.84-.43,1.42-1.21,1.57-2.15l.28-1.71c.17-1.05,1.17-1.77,2.22-1.61l1.71,.26c.94,.14,1.86-.16,2.53-.83s.97-1.59,.83-2.53l-.26-1.71c-.16-1.05,.56-2.04,1.61-2.22l1.71-.28c.93-.15,1.72-.73,2.15-1.57s.43-1.81,0-2.66l-.77-1.55c-.48-.95-.1-2.12,.85-2.61l1.54-.8c.84-.44,1.41-1.22,1.56-2.16,.15-.94-.15-1.86-.81-2.54l-1.21-1.23Zm1.04,3.61c-.1,.62-.47,1.14-1.03,1.43l-1.54,.8c-1.43,.74-2,2.51-1.28,3.94l.77,1.55c.28,.56,.28,1.2,0,1.76-.29,.56-.8,.94-1.42,1.04l-1.71,.28c-1.58,.26-2.68,1.77-2.44,3.35l.26,1.71c.09,.62-.11,1.23-.55,1.67-.44,.44-1.05,.64-1.67,.55l-1.71-.26c-1.58-.24-3.09,.85-3.35,2.44l-.28,1.71c-.1,.62-.48,1.14-1.04,1.42-.56,.29-1.2,.29-1.76,0l-1.55-.77c-1.44-.72-3.21-.14-3.94,1.28l-.79,1.54c-.29,.56-.81,.93-1.43,1.03-.62,.1-1.23-.1-1.68-.54l-1.23-1.21c-1.14-1.13-3-1.13-4.15,0l-1.23,1.21c-.45,.44-1.06,.64-1.68,.54-.62-.1-1.14-.47-1.43-1.03l-.8-1.53c-.52-1.01-1.56-1.59-2.63-1.59-.44,0-.89,.1-1.31,.31l-1.55,.77c-.56,.28-1.2,.28-1.76,0-.56-.29-.94-.8-1.04-1.42l-.28-1.71c-.26-1.58-1.76-2.68-3.35-2.44l-1.71,.26c-.61,.09-1.23-.11-1.67-.55-.44-.44-.64-1.05-.55-1.67l.26-1.71c.24-1.59-.85-3.09-2.44-3.35l-1.71-.28c-.62-.1-1.14-.48-1.42-1.04-.28-.56-.29-1.2,0-1.76l.77-1.55c.72-1.44,.14-3.2-1.28-3.94l-1.54-.8c-.56-.29-.93-.81-1.03-1.43s.1-1.23,.54-1.68l1.21-1.23c1.13-1.14,1.13-3,0-4.15l-1.21-1.23c-.44-.45-.64-1.06-.54-1.68s.47-1.14,1.03-1.43l1.53-.8c1.43-.74,2-2.51,1.28-3.94l-.77-1.55c-.28-.56-.28-1.2,0-1.76,.29-.56,.8-.94,1.42-1.04l1.71-.28c1.58-.26,2.68-1.77,2.44-3.35l-.26-1.71c-.09-.62,.11-1.23,.55-1.67,.44-.44,1.05-.64,1.67-.55l1.71,.26c1.58,.24,3.09-.85,3.35-2.44l.28-1.71c.1-.62,.48-1.14,1.04-1.42,.56-.28,1.2-.29,1.76,0l1.55,.77c1.43,.72,3.2,.15,3.94-1.28l.8-1.54c.29-.56,.81-.93,1.43-1.03,.62-.1,1.23,.1,1.68,.54l1.23,1.21c1.14,1.13,3,1.13,4.15,0l1.23-1.21c.45-.44,1.06-.64,1.68-.54,.62,.1,1.14,.47,1.43,1.03l.79,1.54c.74,1.43,2.51,2,3.94,1.28l1.55-.77c.56-.28,1.21-.28,1.76,0,.56,.28,.94,.8,1.04,1.42l.28,1.71c.26,1.59,1.77,2.68,3.35,2.44l1.71-.26c.61-.09,1.23,.11,1.67,.55,.44,.44,.64,1.05,.55,1.67l-.26,1.71c-.24,1.59,.85,3.09,2.44,3.35l1.71,.28c.62,.1,1.14,.48,1.42,1.04,.28,.56,.29,1.2,0,1.76l-.77,1.55c-.72,1.44-.15,3.2,1.28,3.94l1.54,.8c.56,.29,.93,.81,1.03,1.43s-.1,1.23-.54,1.68l-1.22,1.23c-1.13,1.14-1.13,3,0,4.15l1.21,1.23c.44,.45,.64,1.06,.54,1.68Z"/>
          <path class="b"
                d="M22.8,34.1c.77-.35,1.36-.84,1.78-1.49,.42-.64,.62-1.41,.62-2.3s-.21-1.7-.62-2.34c-.42-.64-1.01-1.13-1.78-1.48-.77-.34-1.69-.51-2.77-.51h-4.6v12.84h.94v-4.2h3.67c.44,0,.84-.04,1.23-.09l3.08,4.29h1.06l-3.22-4.49c.21-.07,.42-.14,.61-.23Zm-6.44-.3v-6.97h3.67c1.38,0,2.43,.3,3.14,.91s1.07,1.46,1.07,2.58-.36,1.96-1.07,2.57-1.76,.92-3.14,.92h-3.67Z"/>
          <polygon class="b"
                   points="29.57 32.72 36.41 32.72 36.41 31.9 29.57 31.9 29.57 26.83 37.22 26.83 37.22 25.99 28.64 25.99 28.64 38.83 37.49 38.83 37.49 37.98 29.57 37.98 29.57 32.72"/>
          <path class="b"
                d="M42.2,28.37c.52-.51,1.13-.91,1.83-1.19,.7-.28,1.46-.42,2.28-.42,.75,0,1.45,.12,2.12,.36,.67,.24,1.27,.63,1.82,1.16l.59-.6c-.56-.6-1.24-1.05-2.03-1.34-.79-.29-1.63-.44-2.54-.44-.95,0-1.83,.16-2.64,.49-.81,.32-1.51,.78-2.12,1.37s-1.07,1.27-1.4,2.06c-.33,.79-.5,1.65-.5,2.59s.17,1.81,.5,2.59,.79,1.48,1.39,2.06c.6,.59,1.3,1.04,2.12,1.37,.81,.32,1.7,.49,2.65,.49,.9,0,1.75-.15,2.54-.45,.79-.3,1.46-.75,2.03-1.35l-.59-.61c-.55,.55-1.16,.94-1.82,1.18-.67,.24-1.37,.36-2.12,.36-.82,0-1.58-.14-2.28-.42-.7-.28-1.31-.68-1.83-1.19s-.92-1.11-1.21-1.8c-.29-.68-.43-1.43-.43-2.24s.14-1.55,.43-2.24c.29-.68,.69-1.28,1.21-1.8Z"/>
        </svg>
        Рекомендации
      </button>
      <button
         v-on:click=" () => {
            this.products = this.products.slice(this.products.length, this.products.length)
           getProducts('newest')
           this.tab = 'fresh'
         }"
         class="fresh"
         :class="{
           active: this.tab === 'fresh'
        }">
        <svg id="a" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64.93 64.94">

          <path class="b"
                d="M62.87,33.84c-.75-.76-.75-1.98,0-2.74l1.21-1.23c.67-.67,.96-1.6,.81-2.54-.15-.94-.72-1.72-1.56-2.16l-1.54-.8c-.94-.49-1.32-1.66-.85-2.61l.77-1.55c.42-.85,.42-1.82,0-2.66-.43-.84-1.21-1.42-2.15-1.57l-1.71-.28c-1.05-.17-1.77-1.17-1.61-2.22l.26-1.71c.14-.94-.16-1.86-.83-2.53-.67-.67-1.58-.97-2.53-.83l-1.71,.26c-1.04,.16-2.04-.56-2.22-1.61l-.28-1.71c-.15-.94-.73-1.72-1.57-2.15-.84-.43-1.82-.43-2.66,0l-1.55,.78c-.95,.48-2.12,.09-2.61-.85l-.8-1.54c-.44-.84-1.22-1.41-2.16-1.56-.94-.15-1.86,.15-2.54,.81l-1.23,1.21c-.75,.75-1.98,.75-2.74,0l-1.23-1.21c-.67-.67-1.6-.96-2.53-.81-.94,.15-1.72,.72-2.16,1.56l-.8,1.54c-.49,.94-1.66,1.32-2.61,.85l-1.55-.77c-.85-.42-1.82-.42-2.66,0-.84,.43-1.42,1.21-1.57,2.15l-.28,1.71c-.17,1.05-1.17,1.77-2.22,1.61l-1.71-.26c-.94-.15-1.86,.16-2.53,.83-.67,.67-.97,1.59-.83,2.53l.26,1.71c.16,1.05-.56,2.04-1.61,2.22l-1.71,.28c-.94,.15-1.72,.73-2.15,1.57s-.43,1.81,0,2.66l.77,1.55c.48,.95,.1,2.12-.85,2.61l-1.54,.8c-.84,.44-1.41,1.22-1.56,2.16-.15,.94,.15,1.86,.81,2.53l1.21,1.23c.75,.76,.75,1.99,0,2.74l-1.21,1.23c-.67,.67-.96,1.6-.81,2.54,.15,.94,.72,1.72,1.56,2.16l1.54,.8c.94,.49,1.32,1.66,.85,2.61l-.77,1.55c-.42,.85-.42,1.82,0,2.66s1.21,1.42,2.15,1.57l1.71,.28c1.05,.17,1.77,1.17,1.61,2.22l-.26,1.71c-.14,.94,.16,1.86,.83,2.53,.67,.67,1.59,.98,2.53,.83l1.71-.26c1.05-.16,2.04,.57,2.22,1.61l.28,1.71c.15,.93,.73,1.72,1.57,2.15,.84,.43,1.81,.43,2.66,0l1.55-.77c.95-.48,2.12-.1,2.61,.85l.8,1.53c.44,.84,1.22,1.41,2.16,1.56,.94,.15,1.86-.15,2.54-.81l1.23-1.21c.76-.75,1.99-.75,2.74,0l1.23,1.21c.56,.55,1.29,.85,2.06,.85,.16,0,.31-.01,.47-.04,.94-.15,1.72-.72,2.16-1.56l.8-1.54c.49-.94,1.66-1.32,2.61-.85l1.55,.77c.85,.42,1.82,.42,2.66,0,.84-.43,1.42-1.21,1.57-2.15l.28-1.71c.17-1.05,1.17-1.77,2.22-1.61l1.71,.26c.94,.15,1.86-.16,2.53-.83s.97-1.59,.83-2.53l-.26-1.71c-.16-1.05,.56-2.05,1.61-2.22l1.71-.28c.93-.15,1.72-.73,2.15-1.57s.43-1.81,0-2.66l-.77-1.55c-.48-.95-.1-2.12,.85-2.61l1.53-.8c.84-.44,1.41-1.22,1.56-2.16,.15-.94-.15-1.86-.81-2.53l-1.21-1.23Zm1.04,3.61c-.1,.62-.47,1.14-1.03,1.43l-1.53,.8c-1.43,.74-2,2.51-1.28,3.94l.77,1.55c.28,.56,.28,1.2,0,1.76-.29,.56-.8,.94-1.42,1.04l-1.71,.28c-1.58,.26-2.68,1.77-2.44,3.35l.26,1.71c.09,.62-.11,1.23-.55,1.67-.44,.44-1.05,.64-1.67,.55l-1.71-.26c-1.58-.24-3.09,.85-3.35,2.44l-.28,1.71c-.1,.62-.48,1.14-1.04,1.42-.56,.28-1.2,.29-1.76,0l-1.55-.77c-1.43-.72-3.2-.15-3.94,1.28l-.8,1.54c-.29,.56-.81,.93-1.43,1.03-.62,.1-1.23-.1-1.68-.54l-1.23-1.21c-1.14-1.13-3-1.13-4.15,0l-1.23,1.21c-.45,.44-1.05,.64-1.68,.54-.62-.1-1.14-.47-1.43-1.03l-.8-1.53c-.52-1.01-1.56-1.59-2.63-1.59-.44,0-.89,.1-1.31,.31l-1.55,.77c-.56,.28-1.2,.28-1.76,0-.56-.29-.94-.8-1.04-1.42l-.28-1.71c-.26-1.58-1.77-2.68-3.35-2.44l-1.71,.26c-.62,.09-1.23-.11-1.67-.55-.44-.44-.64-1.05-.55-1.67l.26-1.71c.24-1.59-.85-3.09-2.44-3.35l-1.71-.28c-.62-.1-1.14-.48-1.42-1.04-.28-.56-.29-1.2,0-1.76l.77-1.55c.72-1.44,.15-3.2-1.28-3.94l-1.54-.8c-.56-.29-.93-.81-1.03-1.43-.1-.62,.1-1.23,.54-1.68l1.21-1.23c1.13-1.14,1.13-3,0-4.15l-1.21-1.23c-.44-.45-.64-1.06-.54-1.68,.1-.62,.47-1.14,1.03-1.43l1.54-.8c1.43-.74,2-2.51,1.28-3.94l-.77-1.55c-.28-.56-.28-1.2,0-1.76,.28-.56,.8-.94,1.42-1.04l1.71-.28c1.58-.26,2.68-1.77,2.44-3.35l-.26-1.71c-.09-.62,.11-1.23,.55-1.67s1.05-.65,1.67-.55l1.71,.26c1.59,.24,3.09-.85,3.35-2.44l.28-1.71c.1-.62,.48-1.14,1.04-1.42,.56-.29,1.2-.29,1.76,0l1.55,.78c1.44,.72,3.21,.14,3.94-1.28l.8-1.54c.29-.56,.81-.93,1.43-1.03,.62-.1,1.23,.1,1.68,.54l1.23,1.21c1.14,1.13,3,1.13,4.15,0l1.23-1.21c.45-.44,1.06-.64,1.68-.54,.62,.1,1.14,.47,1.43,1.03l.8,1.54c.74,1.43,2.51,2,3.94,1.28l1.55-.78c.56-.28,1.2-.28,1.76,0,.56,.28,.94,.8,1.04,1.42l.28,1.71c.26,1.58,1.77,2.68,3.35,2.44l1.71-.26c.62-.09,1.23,.11,1.67,.55,.44,.44,.64,1.05,.55,1.67l-.26,1.71c-.24,1.59,.85,3.09,2.44,3.35l1.71,.28c.62,.1,1.14,.48,1.42,1.04,.28,.56,.29,1.2,0,1.76l-.77,1.55c-.72,1.44-.14,3.21,1.28,3.94l1.54,.8c.56,.29,.93,.81,1.03,1.43s-.1,1.23-.54,1.68l-1.21,1.23c-1.13,1.14-1.13,3,0,4.15l1.21,1.23c.44,.45,.64,1.06,.54,1.68Z"/>
          <polygon class="b"
                   points="20.65 37.13 11.92 25.99 11.13 25.99 11.13 38.83 12.07 38.83 12.07 27.68 20.82 38.83 21.59 38.83 21.59 25.99 20.65 25.99 20.65 37.13"/>
          <polygon class="b"
                   points="26.99 32.72 33.83 32.72 33.83 31.9 26.99 31.9 26.99 26.83 34.64 26.83 34.64 25.99 26.06 25.99 26.06 38.83 34.92 38.83 34.92 37.98 26.99 37.98 26.99 32.72"/>
          <polygon class="b"
                   points="50.45 37.56 46.45 25.99 45.55 25.99 41.53 37.54 37.63 25.99 36.64 25.99 41 38.83 41.99 38.83 45.98 27.31 49.97 38.83 50.96 38.83 55.31 25.99 54.39 25.99 50.45 37.56"/>
        </svg>

        Новые
      </button>
    </div>
    <div class="tabs-content-wrapper" ref="productsWrapper">
      <loader v-if="loading === true"></loader>
      <transition-group name="list" tag="div" class="tabs-content" v-else>

        <Carousel v-bind="settings" :breakpoints="breakpoints" :wrap-around="true">
          <Slide class="shop-view" v-for="item in products" v-if="products.length > 0 && loading === false" >
            <services-card
                ref="sliderItem"
                v-bind:name="item.name"
                v-bind:image="`${config.api.url}${item.avatarFilePath}`"
                v-bind:id="item.id"
                v-bind:projectId="item.ProjectId"
                v-bind:isOwner="false"
                v-bind:clickable="true"
            >
            </services-card>
          </Slide>

          <template #addons>
            <Navigation />
          </template>
        </Carousel>


      </transition-group>

    </div>

  </div>
  </transition>
</template>

<script>
import { ref } from 'vue'
import servicesCard from "../Cards/ServicesCard.vue";
import loader from "./Loader.vue";
import config from "../../../assets/js/config.js";
import 'vue3-carousel/dist/carousel.css'
import { Carousel, Slide, Pagination, Navigation } from 'vue3-carousel'

export default {
  name: "Recommended.vue",
  components: {servicesCard,
    loader,
    Carousel,
    Slide,
    Pagination,
    Navigation,},


  data() {
    return {
      recommendedShops: ref(null),
      tab: 'recommended',
      products: [],
      loading: true,
      disableSliderArrows: false,
      config,

      settings: {
        itemsToShow: 3.5,
        snapAlign: 'start',
        autoplay: 5000,
      },
      breakpoints: {
        320: {
          itemsToShow: 2,
          snapAlign: 'start',
        },
        400: {
          itemsToShow: 2,
          snapAlign: 'start',
        },
        // 700px and up
        768: {
          itemsToShow: 2.3,
          snapAlign: 'start',
        },
        // 1024 and up
        1024: {
          itemsToShow: 3.5,
          snapAlign: 'start',
        },
      },
    }
  },
  methods: {


    switchTabs(tab) {
      this.tab = tab
    },

    getProducts(sort) {
      this.loading = true

      const myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");
      myHeaders.append("Authorization", `Bearer ${localStorage.getItem('token')}`);
      const projectId = window.location.pathname.replace('/project/', '');

      const requestOptions = {
        method: "GET",
        headers: myHeaders,
      };

      fetch(`${config.api.url}products?limit=8&sort=${sort}`, requestOptions)
          .then((response) => response.json())
          .then((result) => {
            for (let product of result.products) {
              this.products.push(product)
            }

            if (this.products.length < 5) {
              this.disableSliderArrows = true
            }

            this.loading = false
          })
          .catch((error) => console.error(error));

  },

},
  mounted() {
    this.getProducts('random')


  },


}
</script>

<style scoped lang="scss">
.tabs-links {
  display: flex;

  button {
    display: flex;
    align-items: center;
    margin-right: 10px;
    svg {
      width: 25px;
      height: 25px;
      margin-right: 5px;
      path, polygon {
        stroke: black;
        fill: black;
      }
    }

    &.active {
      svg {
        path, polygon {
          stroke: white ;
          fill: white;
        }
      }
    }
  }

}
.tabs-content-wrapper {
  width: 100%;
}

.carousel__next, .carousel__prev {
  background-color: #fff!important;
  padding: 10px;
  border-radius: 200px;
}

.tabs-content {
  width: 100%;
  justify-content: start;
  margin-top: 30px;

  gap: 20px;
  box-sizing: border-box;
  display: flex;
  flex-wrap: nowrap;
  left: v-bind('margin');
  transition: .3s ease;

  .carousel {
    width: 100%;


  }


  .shop-view {
    display: flex;
    width: 25%;
    gap: 20px;
    min-height: 200px;
    color: var(--vc-clr-white);
    font-size: 20px;
    overflow-y: visible;
    border-radius: 8px;
    justify-content: start;
    align-items: stretch;
  }
}

@media screen and (max-width: 768px) {
  .tabs-content {
    flex-wrap: wrap;
    .shop-view {
      width: 100%;
    }
  }
}

</style>